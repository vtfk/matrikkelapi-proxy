/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Import dependencies
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const http = require('http');                                           // For hosting the web server
const express = require('express');                                     // Web server framework
const path = require('path');                                           // For joining local paths
const morgan = require('morgan');                                       // For outputing information about the requests
const cors = require('cors');                                           // For handeling CORS

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Determine environment variables
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const host = process.env.host || '0.0.0.0';                             // Get the hosting address
const port = process.env.port || 8086;                                  // Get the hosting port

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Create App
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const app = express();

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Register middleware
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
app.use(express.json());                                                // Automatically parse JSON body
app.use(morgan('dev'));                                                 // Output request information to stdout

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Handle CORS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const corsOptions = {
    origin: true,
    credentials: true
  }
app.use(cors(corsOptions));

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Routes
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
app.use('/api/v1/matrikkel', require('./routes/v1/matrikkel'));
app.use('/api/v1/teig', require('./routes/v1/teig'));

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Host the server
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const server = http.createServer(app);
server.listen(port, host, () => {
  let hostname = host;
  if (host === '0.0.0.0') { hostname = 'localhost' }

  console.log('Your server is listening on port %d (http://%s:%d)', port, hostname, port);
  console.log('Swagger-ui is available on http://%s:%d/api/v1/docs', hostname, port);
  // console.log('Swagger-ui is available on http://app.indcidenthub.no:' + port + '/api/v1/docs');
})