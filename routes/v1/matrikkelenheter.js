/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Import dependencies
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const express = require('express');
const router = express.Router();
const MatrikkelClient = require('../../lib/KartverketMatrikkelAPI/MatrikkelClient');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Routes
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
router.post('/', async (req, res, next) => {
  try {
    // Construct the polygon
    res.setHeader('Content-Type', 'application/json');
    const client = new MatrikkelClient('vtfkBergstrom', '496fPqhJ<qCtu(qAM7Z]', 'https://prodtest.matrikkel.no:443/matrikkelapi/wsapi/v1/MatrikkelenhetServiceWS');

    const result = await client.getMatrikkelPolygon(req, req.body.polygon)

    res.type('json').send(JSON.stringify(result, null, 2));
  } catch (err) {
    return next(err);
  }
})

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Exports
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
module.exports = router;
