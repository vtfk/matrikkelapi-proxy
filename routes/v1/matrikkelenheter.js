/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Import dependencies
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const express = require('express');
const router = express.Router();
const MatrikkelClient = require('../../lib/KartverketMatrikkelAPI/MatrikkelClient');
const config = require('../../config');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Routes
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
router.post('/', async (req, res, next) => {
  try {
    // Construct the client
    res.setHeader('Content-Type', 'application/json');
    const client = new MatrikkelClient(config.MATRIKKELAPI_USERNAME, config.MATRIKKELAPI_PASSWORD, 'matrikkelapi/wsapi/v1/MatrikkelenhetServiceWS');
    // Get the matrikkel polygon
    req.response = await client.getMatrikkelPolygon(req, req.body.polygon);
    // Pass to next function
    next();
  } catch (err) {
    return next(err);
  }
})

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Exports
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
module.exports = router;
